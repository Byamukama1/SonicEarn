<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Account — Success Pay Investments</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    :root{
      --navy-900:#0b1220; --navy-800:#111827;
      --ink:#0b1324; --muted:#64748b; --card:#ffffff; --border:#e5e7eb;
      --accent:#f59e0b; --accent2:#d97706; --shadow:0 16px 40px rgba(2,6,23,.08);
      --navH:64px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:linear-gradient(160deg,var(--navy-900) 0%, #101a2f 60%, var(--navy-800) 100%);
      font-family: system-ui,-apple-system,"Segoe UI",Roboto,Arial,"Noto Sans",sans-serif;
      color:var(--ink);
    }
    .app{min-height:100svh; display:flex; flex-direction:column; padding-bottom:calc(var(--navH) + env(safe-area-inset-bottom,0px));}

    /* HEADER */
    header{
      padding:16px; color:#f8fafc;
      background:linear-gradient(135deg, rgba(245,158,11,.18), transparent 40%);
      display:flex; align-items:center; gap:12px;
    }
    header i{
      width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;
      background:rgba(245,158,11,.14); color:#f59e0b; border:1px solid rgba(245,158,11,.22);
    }
    header h1{margin:0;font-size:18px;font-weight:800}
    header small{color:#d1d5db}

    /* SHEET */
    .sheet{background:#fff;border-radius:18px 18px 0 0;margin-top:8px;padding:16px}

    /* CARDS */
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:14px}
    .title{font-size:16px;font-weight:800;margin:0 0 10px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:640px){.row{grid-template-columns:1fr}}
    .item{background:#f9fafb;border:1px solid var(--border);border-radius:12px;padding:10px}
    .label{font-size:12px;color:var(--muted)}
    .val{font-weight:700}
    .mono{font-feature-settings:"tnum" 1,"lnum" 1}

    .btn, .link{
      display:inline-flex;align-items:center;gap:8px;justify-content:center;text-decoration:none;cursor:pointer;
      padding:12px 14px;border:none;border-radius:12px;font-weight:800;color:#111827;
      background:linear-gradient(180deg,var(--accent),var(--accent2)); box-shadow:0 12px 26px rgba(217,119,6,.28);
    }
    .btn i,.link i{color:#111827}

    .support-actions{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:680px){.support-actions{grid-template-columns:1fr}}
    .sub{font-size:12px;color:var(--muted);margin-top:6px}

    /* NAV */
    nav{
      position:fixed; left:0; right:0; bottom:0; height:var(--navH);
      background:#fff; border-top:1px solid var(--border);
      display:grid; grid-template-columns:repeat(4,1fr);
      padding-bottom:env(safe-area-inset-bottom,0px); z-index:10;
    }
    .tab{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;
      color:var(--muted);font-size:11px;text-decoration:none}
    .tab i{font-size:18px}
    .tab.active{color:#111827;font-weight:700}
    .tab.active i{color:#d97706}

    /* Skeleton */
    .skeleton{background:linear-gradient(90deg,#f3f4f6 25%,#eceef2 37%,#f3f4f6 63%); background-size:400% 100%; animation:sh 1.2s infinite}
    @keyframes sh{0%{background-position:100% 0}100%{background-position:0 0}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <i class="fas fa-user-circle"></i>
      <div>
        <h1>My Account</h1>
        <small>Success Pay Investments</small>
      </div>
    </header>

    <div class="sheet">
      <div class="grid">
        <!-- Profile & Contact -->
        <div class="card">
          <h2 class="title">Profile</h2>
          <div class="row">
            <div class="item"><div class="label">Name</div><div id="uName" class="val skeleton" style="height:20px;border-radius:6px"></div></div>
            <div class="item"><div class="label">Nickname</div><div id="uNick" class="val skeleton" style="height:20px;border-radius:6px"></div></div>
            <div class="item"><div class="label">Email</div><div id="uEmail" class="val skeleton" style="height:20px;border-radius:6px"></div></div>
            <div class="item"><div class="label">Phone</div><div id="uPhone" class="val skeleton" style="height:20px;border-radius:6px"></div></div>
            <div class="item"><div class="label">Referrer</div><div id="uRef" class="val skeleton" style="height:20px;border-radius:6px"></div></div>
            <div class="item"><div class="label">User ID (UID)</div><div id="uId" class="val mono skeleton" style="height:20px;border-radius:6px"></div></div>
          </div>
          
        </div>

        <!-- Financials -->
        <div class="card">
          <h2 class="title">Financials</h2>
          <div class="row">
            <div class="item"><div class="label">Account Balance (UGX)</div><div id="uBal" class="val mono skeleton" style="height:20px;border-radius:6px"></div></div>
            <div class="item"><div class="label">Total Deposits (UGX)</div><div id="uDep" class="val mono skeleton" style="height:20px;border-radius:6px"></div></div>
            <div class="item"><div class="label">Total Withdrawn (UGX)</div><div id="uWit" class="val mono skeleton" style="height:20px;border-radius:6px"></div></div>
            <div class="item"><div class="label">Total Earnings (UGX)</div><div id="uEarn" class="val mono skeleton" style="height:20px;border-radius:6px"></div></div>
          </div>
          <div class="sub">Totals reflect approved transactions and processed earnings.</div>
        </div>
      </div>

      <!-- Support -->
      <div class="card" style="margin-top:12px">
        <h2 class="title">Customer Support</h2>
        <div class="support-actions">
          <a class="link" target="_blank" href="https://wa.me/256741371770?text=Hello%20Support%201%2C%20I%20need%20help%20with%20my%20Success%20Pay%20account.">
            <i class="fab fa-whatsapp"></i> Chat Support 1 — +256 741 371 770
          </a>
          <a class="link" target="_blank" href="https://wa.me/256780288376?text=Hello%20Support%202%2C%20I%20need%20help%20with%20my%20Success%20Pay%20account.">
            <i class="fab fa-whatsapp"></i> Chat Support 2 — +256 780 288 376
          </a>
          <a class="link" target="_blank" href="https://wa.me/256767009532?text=Hello%20Support%203%2C%20I%20need%20help%20with%20my%20Success%20Pay%20account.">
            <i class="fab fa-whatsapp"></i> Chat Support 3 — +256 767 009 532
          </a>
          <a class="link" target="_blank" href="https://chat.whatsapp.com/EwhkDTa6yHC6V9tSFcgyGM?mode=ac_t">
            <i class="fab fa-whatsapp"></i> Join WhatsApp Group
          </a>
        </div>
        <div class="sub">All support buttons open WhatsApp chats directly.</div>
      </div>

      <!-- Quick Actions -->
      <div class="card" style="margin-top:12px">
        <h2 class="title">Quick Actions</h2>
        <div class="support-actions">
          <a class="btn" href="deposit.html"><i class="fas fa-arrow-down"></i> Deposit</a>
          <a class="btn" href="withdraw.html"><i class="fas fa-arrow-up"></i> Withdraw</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Navigation (same as home) -->
  <nav>
    <a class="tab" href="index.html"><i class="fas fa-home"></i><span>Home</span></a>
    <a class="tab" href="investments.html"><i class="fas fa-chart-line"></i><span>Investments</span></a>
    <a class="tab" href="referrals.html"><i class="fas fa-user-friends"></i><span>Refer</span></a>
    <a class="tab active" href="account.html" aria-current="page"><i class="fas fa-user"></i><span>Account</span></a>
  </nav>

  <!-- Firebase + Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDqXsmhAt_jDRC3sYzSZ0mJXGLHoQYlPBc",
      authDomain: "sonicearn-a13b3.firebaseapp.com",
      projectId: "sonicearn-a13b3",
      storageBucket: "sonicearn-a13b3.firebasestorage.app",
      messagingSenderId: "538538743721",
      appId: "1:538538743721:web:3ca577a8b2a6ba43e416b8",
      measurementId: "G-XGD292PMYM"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const fmt = n => new Intl.NumberFormat('en-UG',{maximumFractionDigits:0}).format(Math.round(Number(n||0)));

    function setText(id, text){
      const el = document.getElementById(id);
      el.classList.remove('skeleton');
      el.textContent = text ?? '—';
    }

    async function loadUser(uid){
      const snap = await getDoc(doc(db,'users', uid));
      const fallback = (v, dash='—') => (v===undefined || v===null || v==='') ? dash : v;

      setText('uId', uid);

      if(!snap.exists()){
        setText('uName','—'); setText('uNick','—'); setText('uEmail','—'); setText('uPhone','—'); setText('uRef','—');
        setText('uBal','0'); setText('uDep','0'); setText('uWit','0'); setText('uEarn','0');
        return;
      }
      const u = snap.data();
      setText('uName',  fallback(u.name));
      setText('uNick',  fallback(u.nickname));
      setText('uEmail', fallback(u.email));
      setText('uPhone', fallback(u.phone));
      setText('uRef',   fallback(u.referrerNickname));
      setText('uBal',   'UGX ' + fmt(u.accountBalance));
      setText('uDep',   'UGX ' + fmt(u.totalDeposits));
      setText('uWit',   'UGX ' + fmt(u.totalWithdrawn));
      setText('uEarn',  'UGX ' + fmt(u.totalEarnings));
    }

    onAuthStateChanged(auth, (user)=>{
      if(!user){ location.href='login.html'; return; }
      loadUser(user.uid).catch(err=>alert(err.message));
    });
  </script>
</body>
</html>